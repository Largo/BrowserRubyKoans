<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Run Ruby code in browser</title>
    <link rel="stylesheet" href="assets/app.css">
    <script src="browser.script.iife.js"></script>
    <link rel="stylesheet" href="assets/codemirror.css">
    <script src="assets/codemirror.js"></script>
    <script src="assets/codemirror-ruby.js"></script>
</head>
<body>
    <h1>Code Runner</h1>
    <textarea id="ruby-code" rows="10" cols="50"></textarea><br>
    <button id="run-code">Run Code</button>
    <div id="output"></div>
  
  <script async>
    window.addEventListener('load', async function () {
        var code_area = document.getElementById("ruby-code")
        var editor = CodeMirror.fromTextArea(code_area, {
            lineNumbers: true,
            mode: "text/x-ruby",
            matchBrackets: true,
            indentUnit: 4
        });
        document.getElementById("run-code").addEventListener("click", async (e) => {
            editor.save()
            var output_div = document.getElementById("output");
            var code = `
                require 'js/require_remote'
                module Kernel
                    alias original_require_relative require_relative
                    def require_relative(path) = JS::RequireRemote.instance.load(path)
                end
                require_relative 'main.rb'
                require_relative 'buttonPress.rb'
                pressButton {
                    ${code_area.value}
                }
            `.trim()
            const text = window.rubyVM.evalAsync(code).then((response) => {
                output_div.innerHTML = response.toString();
            }).catch((response) => {
                output_div.innerHTML = response.toString();
            });
        });
    });
  </script>
</body>
</html>
